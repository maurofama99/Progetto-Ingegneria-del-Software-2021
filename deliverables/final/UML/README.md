# Communication Protocol

You can find the sequence diagram file here: 
[Sequence Diagrams](https://github.com/maurofama99/ing-sw-2021-detomas-fama-grazian/tree/main/deliverables/final/UML/SequenceDiagrams.png)

## Connection
In the phase of connection to the Server by the Client, the latter is asked to enter the IP of the server to which he wishes to connect and the port to use (via parameter for CLI mode, via keyboard input for GUI mode) . It then creates a stream socket and connects it to the specified port number on the named host. Once the connection has been created, the server sends the client a login request, the client must then enter his nickname (different from that of any players in the waiting room) and the number of players with whom he wishes to play. At this point, the client will be put on hold for a game.

## Market action
The exchange of messages referring to the action of going to market starts with the client sending the specific goingMarket message to the server, passing as arguments the desired row or column index of the displayed "Market Tray" and a Boolean variable indicating whether the index refers to the rows or columns. If the player has chosen a row of marbles that does not include any resource placement in the vault, the action ends with a notification from the server. If the player has resources to place, the server first checks if he has two leader cards active with the special effect of replacing the white marbles with another resource, in this case, it asks the client which of the two resources indicated in the cards he wants for each white marble chosen. At this point it is asked for each resource in which floor of the deposit it must be placed and the client can respond with: the desired floor, "discard" to discard the resource, "extra" to place the resource in any additional deposit provided by a leader card or "switch" to exchange resources between floors before placing the resource. All these actions are carried out only if they follow the rules of the game, otherwise, the server will ask you to repeat the action.

## Play a leader
During the beginning and end of their turn, a player can activate or discard their leader cards. At this point in the game, the server sends a message to the client with the list of leader cards that the player has. At this point, the player can decide whether to activate or discard one of the two leader cards by providing the reference (card index) or to continue to the next phase of the turn. If the player decides to activate a leader card, the server checks if it is possible to carry out the action, if it has the required requirements, the card is activated. As long as the player has leader cards to activate or discard, the server will continue to send the askPlayLeader message, otherwise, if the player has activated or discarded all available leader cards, this message exchange will no longer take place for the rest of the game. If the player decides not to activate or discard a leader card, the client will send the DoneAction message to the server and, depending on the phase (beginning or end) of the turn, the turn will continue or end. The boolean variable isEndTurn identifies what phase of the turn the player is in.
